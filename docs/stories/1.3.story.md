# Story 1.3: Create Core Types and Data Structures

## Status
Done

## Story
**As a** research engineer coordinating the pilot experiment,
**I want** canonical TypeScript types for cooperation conditions, scenarios, and results,
**so that** every module in the pilot study uses the same contracts without guesswork.

## Acceptance Criteria
1. TypeScript interfaces for experimental conditions
2. Types for agent responses and decisions
3. Scenario configuration types
4. Result storage structures defined

## Tasks / Subtasks
- [x] Task 1: Define pilot condition types (AC: 1)
  - [x] Update `src/cooperation/types.ts` with a `Condition` interface limited to the `symmetry` and `coupling` factors retained for the pilot (compliance removed). [Source: prd/pilot-study-scope-4-5-hour-implementation.md#Simplified 2×2 Factorial]
  - [x] Expose `SymmetryLevel` and `CouplingMode` string literal unions so other modules consume a single source of truth for valid values. [Source: architecture/data-models-simple-types.md#Minimal Types You Need]
- [x] Task 2: Model agent response contracts (AC: 2)
  - [x] Create an `AgentDecision` union constrained to `COORDINATE` | `PREEMPT` and embed it in an `AgentResponse` interface that includes the raw model output string. [Source: architecture/data-models-simple-types.md#Minimal Types You Need]
  - [x] Document a lightweight `DecisionExtractionResult` type the `DecisionExtractor` can return to signal matched decisions or nulls. [Source: architecture/component-architecture-simplified.md#DecisionExtractor]
- [x] Task 3: Capture scenario configuration schema (AC: 3)
  - [x] Add `ScenarioTemplate` and `ScenarioConfig` interfaces describing template identifiers, parameter slots, and associated `Condition` references for the cooperation prompts. [Source: architecture/component-architecture-simplified.md#ScenarioGenerator]
  - [x] Include a `seed` field or `SeededRandom` reference in the scenario config to keep generation deterministic with the RNG delivered in Story 1.2. [Source: docs/stories/1.2.story.md#Dev Notes]
- [x] Task 4: Specify experiment result storage structures (AC: 4)
  - [x] Formalize per-trial `GameResult` and aggregate `ExperimentBatch` interfaces capturing model id, condition, decision, response text, and timestamps to support JSON persistence. [Source: architecture/data-models-simple-types.md#Minimal Types You Need]
  - [x] Describe a `PersistedResult` helper type with `filePath` and `createdAt` metadata so `CooperationRunner` can emit consistent records into `results/cooperation`. [Source: architecture/component-architecture-simplified.md#CooperationRunner]

## Dev Notes

### Previous Story Insights
- Cooperation runner already handles OpenRouter persistence and rate limiting, so new types must integrate without altering established entry points. [Source: docs/stories/1.1.story.md#Dev Notes]
- SeededRandom guarantees deterministic sequences; scenario-related types should surface seed requirements explicitly to avoid hidden global state. [Source: docs/stories/1.2.story.md#Dev Notes]

### Data Models
- Pilot scope keeps only `symmetry` and `coupling` as condition factors, so the canonical `Condition` interface should omit compliance. [Source: prd/pilot-study-scope-4-5-hour-implementation.md#Simplified 2×2 Factorial]
- Example data model already lays out `GameResult` fields (model, condition, decision, response, timestamp) that this story formalizes for TypeScript consumers. [Source: architecture/data-models-simple-types.md#Minimal Types You Need]

### Component Interfaces
- ScenarioGenerator consumes condition parameters to produce prompts; providing typed templates and config structures keeps that component simple. [Source: architecture/component-architecture-simplified.md#ScenarioGenerator]
- CooperationRunner is responsible for saving each run to JSON, so result structures should align with its save flow. [Source: architecture/component-architecture-simplified.md#CooperationRunner]

### File Locations
- Maintain all cooperation types in `src/cooperation/types.ts` per the documented source tree organization. [Source: architecture/source-tree.md#New File Organization]
- Result-oriented types should reference `results/cooperation` so dev agents know where persisted files belong. [Source: architecture/source-tree.md#New File Organization]

### Technical Stack
- Implement types in TypeScript without adding packages, reusing the Bun/TypeScript toolchain already in place. [Source: architecture/tech-stack-use-whats-already-there.md#Just Reuse Existing]
- Keep decisions and condition values as string literal unions to stay compatible with the lightweight persistence approach. [Source: architecture/tech-stack-use-whats-already-there.md#Dont Add Anything New]

### Testing Requirements
- Pilot architecture prioritizes manual verification, so type definitions should include inline JSDoc guidance instead of new automated tests. [Source: architecture/testing-skip-for-now.md#Manual Testing Only]

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-09-22 | 0.1 | Initial draft | Bob (SM) |
| 2025-09-22 | 1.0 | Implemented cooperation type system and response integration | James |

## Dev Agent Record

### Agent Model Used

- GPT-5 Codex (James)

### Debug Log References

- 2025-09-22 `.ai/debug-log.md` – `bun test`

### Completion Notes List

- Defined canonical cooperation condition, response, scenario, and persistence types and wired decision extraction to null-safe AgentResponse handling.

### File List

- src/cooperation/types.ts
- src/cooperation/index.ts

## QA Results

### 2025-09-22 — Quinn (Test Architect & Quality Advisor)
- **Gate Decision:** PASS — canonical cooperation types meet all acceptance criteria with traceable definitions and no blocking risks.
- **Acceptance Evidence:**
  - *AC1 (Condition interfaces):* `SymmetryLevel`, `CouplingMode`, and `Condition` restrict the pilot factors at `src/cooperation/types.ts:3-9`, aligning with the simplified factorial scope.
  - *AC2 (Agent response contracts):* `AgentDecision`, `AgentResponse`, and `DecisionExtractionResult` capture normalized decisions plus raw model output with null-safe handling at `src/cooperation/types.ts:11-25`.
  - *AC3 (Scenario modeling):* `ScenarioTemplate` and `ScenarioConfig` encode template metadata, parameter slots, and deterministic seeding via optional `SeededRandom` at `src/cooperation/types.ts:27-49`.
  - *AC4 (Result persistence structures):* `GameResult`, `ExperimentBatch`, and `PersistedResult` capture per-trial, batch, and filesystem metadata for JSON persistence at `src/cooperation/types.ts:51-83`.
- **Test Notes:** Type-only update; no automated tests executed for this story yet. Recommend adding compile-time usage assertions once scenario generation integrates.
- **Risks & Follow-ups:**
  - Ensure downstream modules migrate to the new unions so legacy `compliance` references do not resurface.
  - Consider supplying helper factories or discriminated unions for decision parsing to keep null-handling consistent across services.
- **Recommended Status:** Ready for Done
